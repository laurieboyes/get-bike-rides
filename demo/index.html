<html>
<head>
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="../dist/get-google-fit-bike-rides.js"></script>
    <script>
        // prep the Google API stuff
        const googleApiClientId = '447838384773-9n5pf96vipeuedm8ls2und2uu0ekteqt.apps.googleusercontent.com';
        const googleApiKey = 'SqgxaJRRDVB4s3x9zEbkaR4B';

        // getBikeRides provides the scope it requires for the Google API
        const scope = window.getGoogleFitBikeRides.googleApiScope;

        gapi.load('client:auth2', function () {
            gapi.client.setApiKey(googleApiKey);
            gapi.auth2.init({ client_id: googleApiClientId, scope: scope })
        });

        function init() {
            const statusEl = document.querySelector('.js-status');
            const bikeRidesEl = document.querySelector('.js-bike-rides');

            // Note that the Google API should be signed into as a direct result of a user interaction,
            // in order to avoid the login pop-up being blocked
            document.querySelector('.js-get-google-fit-bike-rides').addEventListener('click', function () {

                const from = new Date(document.querySelector('.js-from-date').value);
                const to = new Date(document.querySelector('.js-to-date').value);

                statusEl.textContent = 'Signing into Google';

                gapi.auth2.getAuthInstance().signIn()
                    .then(() => {
                        statusEl.textContent = 'Getting bike rides...';
                        window.getGoogleFitBikeRides(from, to)
                            .then(function (bikeRides) {
                                if (bikeRides.length) {
                                    statusEl.textContent = '';
                                    bikeRidesEl.textContent = JSON.stringify(bikeRides, null, 3);
                                } else {
                                    statusEl.textContent = 'No bike rides found between these dates';
                                }
                            })
                    })
            });
        }

        if (document.readyState != 'loading') {
            init();
        } else {
            document.addEventListener('DOMContentLoaded', init);
        }
    </script>
</head>

<body>
    <h1>Get Bike Rides demo</h1>
    <label for='toDate'>From</label>
    <input id='fromDate' type='date' class='js-from-date' value='2017-02-01' />
    <label for='toDate'>To</label>
    <input id='toDate' type='date' class='js-to-date' value='2017-02-28' />
    <button class='js-get-google-fit-bike-rides'>Sign into Google and get some bikerides</button>
    <p class='js-status'></p>
    <pre class='js-bike-rides'></pre>
</body>
</html>